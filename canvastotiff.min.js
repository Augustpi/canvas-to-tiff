/*
	canvas-to-tiff version 0.3.0 ALPHA
	By Epistemex (c) 2015
	www.epistemex.com
	MIT License (this header required)
*/
var CanvasToTIFF={toArrayBuffer:function(d,c,y){y=y||{};var G=d.width,p=d.height,v=0,s=258,k=0,x=[],r,E="\x63\x61\x6e\x76\x61\x73\x2d\x74\x6f\x2d\x74\x69\x66\x66\x20\x30\x2e\x34\0",u=!!y.littleEndian,g=+(y.dpiX||y.dpi||96)|0,i=+(y.dpiY||y.dpi||96)|0,q=d.getContext("2d").getImageData(0,0,G,p),t=q.data.length,n=s+t,l=new ArrayBuffer(n),m=new Uint8Array(l),F=new DataView(l),A=0,e=new Date(),f;B(u?18761:19789);B(42);C(8);b();a(254,4,1,0);a(256,4,1,G);a(257,4,1,p);a(258,3,4,v,8);a(259,3,1,1);a(262,3,1,2);a(273,4,1,s,0);a(277,3,1,4);a(279,4,1,t);a(282,5,1,v,8);a(283,5,1,v,8);a(296,3,1,2);a(305,2,E.length,v,o(E));a(306,2,20,v,20);a(338,3,1,2);j();C(524296);C(524296);C(g);C(1);C(i);C(1);D(E);f=e.getFullYear()+":"+z(e.getMonth()+1)+":"+z(e.getDate())+" ";f+=z(e.getHours())+":"+z(e.getMinutes())+":"+z(e.getSeconds());D(f);m.set(q.data,s);setTimeout(function(){c(l)},4);function z(h){h+="";return h.length===1?"0"+h:h}function B(h){F.setUint16(A,h,u);A+=2}function C(h){F.setUint32(A,h,u);A+=4}function D(w){var h=0;while(h<w.length){F.setUint8(A++,w.charCodeAt(h++)&255,u)}if(A&1){A++}}function o(w){var h=w.length;return h&1?h+1:h}function a(H,I,h,J,w){B(H);B(I);C(h);if(w){v+=w;x.push(A)}if(h===1&&I===3&&!w){B(J);B(0)}else{C(J)}k++}function b(h){r=h||A;A+=2}function j(){F.setUint16(r,k,u);C(0);var h=14+k*12;for(var w=0,I,H;w<x.length;w++){I=x[w];H=F.getUint32(I,u);F.setUint32(I,H+h,u)}}},toBlob:function(b,a,c){this.toArrayBuffer(b,function(d){a(new Blob([d],{type:"image/tiff"}))},c||{})},toObjectURL:function(b,a,c){this.toBlob(b,function(d){var e=self.URL||self.webkitURL||self;a(e.createObjectURL(d))},c||{})},toDataURL:function(b,a,c){this.toArrayBuffer(b,function(j){var h=new Uint8Array(j),f=1<<20,e=f,g="",d="",k=0,m=h.length;(function n(){while(k<m&&e-->0){g+=String.fromCharCode(h[k++])}if(k<m){e=f;setTimeout(n,CanvasToTIFF._dly)}else{k=0;m=g.length;e=180000;(function i(){d+=btoa(g.substr(k,e));k+=e;(k<m)?setTimeout(i,CanvasToTIFF._dly):a("data:image/tiff;base64,"+d)})()}})()},c||{})},_dly:9};